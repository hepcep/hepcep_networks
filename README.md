# README #

HepCEP project networks repository


## Custom `ergm.userterms` package, including `dist` term

To test the `ergm.userterms` package:  

- Package is on this [repository](https://bitbucket.org/jozik/hepcep_networks/src/master/fit-ergms/).

- Cloning the repository from bitbucket will save the pacakge code.   

- The package can then be installed via `R CMD INSTALL  ergm.userterms`.    
    
- See sample test code below.    <br>  

```
        library(network)

        # Test of dist metric 
        nw.size <- 10000
        m = matrix(c(rep(1,nw.size-1),2:nw.size), byrow = FALSE, ncol = 2)
        ggg <- as.network(m, matrix.type='edgelist',directed = F)
        ggg %v% "lat" <- seq(41.9,41.3,length.out = nw.size)
        ggg %v% "lon" <- rep(-87.6964695120882,times = nw.size)
        summary(ggg ~ dist(1:7))    
```         
            
-  Detailed test code example at [fit-ergms/jozik-network-test.R](https://bitbucket.org/jozik/hepcep_networks/src/master/fit-ergms/jozik-network-test.R).


## Doing the ERGM analysis
   - Go to file [fit-ergms/ergm-estimation-with-meta-data.R](https://bitbucket.org/jozik/hepcep_networks/src/master/fit-ergms/ergm-estimation-with-meta-data.R):
      * All data inputs are in [`data`](https://bitbucket.org/jozik/hepcep_networks/src/master/data/)
      * If needed, the `meta-mixing-init-net.RData` file can be generated by running 
        [fit-ergms/generate-starting-network-meta-data.R](https://bitbucket.org/jozik/hepcep_networks/src/master/fit-ergms/generate-starting-network-meta-data.R)
      * Update lat/lon data as needed (see section `Read lat/lon data ------------------------------ `)

   - I'm working with an older version of ergm (v 3.11.0) to preserve compatibility with the old code.

   - I installed `ergm 3.11.0 was installed via:

```
packageurl <- "https://cran.r-project.org/src/contrib/Archive/ergm/ergm_3.11.0.tar.gz"
install.packages(packageurl, repos=NULL, type="source")
```

the complete `sessionInfo()` is below: 
```
> sessionInfo()
R version 4.1.0 (2021-05-18)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS 12.4

Matrix products: default
LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib

Random number generation:
 RNG:     Mersenne-Twister 
 Normal:  Inversion 
 Sample:  Rounding 
 
locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] ergm_3.11.0    dplyr_1.0.7    network_1.17.1

loaded via a namespace (and not attached):
 [1] magrittr_2.0.1       MASS_7.3-54          tidyselect_1.1.1     lattice_0.20-44     
 [5] R6_2.5.0             rlang_0.4.11         fansi_0.5.0          tools_4.1.0         
 [9] parallel_4.1.0       grid_4.1.0           lpSolve_5.6.15       rle_0.9.2           
[13] utf8_1.2.1           coda_0.19-4          DBI_1.1.1            ellipsis_0.3.2      
[17] assertthat_0.2.1     tibble_3.1.2         lifecycle_1.0.0      crayon_1.4.1        
[21] Matrix_1.3-3         purrr_0.3.4          vctrs_0.3.8          trust_0.1-8         
[25] robustbase_0.93-9    glue_1.4.2           statnet.common_4.5.0 DEoptimR_1.0-9      
[29] compiler_4.1.0       pillar_1.6.1         generics_0.1.0       pkgconfig_2.0.3    
```